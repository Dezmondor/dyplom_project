{% extends "base.html" %}
{% block title %}–ß–∞—Ç —ñ–∑ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º{% endblock %}
{% block content %}
<div class="container py-4">
  <h2 class="text-warning mb-4">
    üí¨ –ß–∞—Ç —ñ–∑ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º: {{ target_user.first_name }} {{ target_user.last_name }}
  </h2>

  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <div id="chat-box" style="height: 400px; overflow-y: auto; border: 1px solid #ccc; border-radius: 10px; padding: 10px; background: #f9f9f9;">
        {% for msg in chat_messages %}
          <div class="mb-2 {% if msg.is_admin %}text-end{% endif %}">
            <div style="display: inline-block; padding: 8px 12px; border-radius: 10px;
                        background-color: {% if msg.is_admin %}#003366; color: white;{% else %}#e6e6e6;{% endif %}">
              <small>
                {% if msg.is_admin %}
                  <strong>–í–∏ (–ê–¥–º—ñ–Ω):</strong>
                {% else %}
                  <strong>{{ target_user.first_name|default:target_user.username }}:</strong>
                {% endif %}
              </small>
              <div>{{ msg.message }}</div>
              <small class="text-muted" style="font-size: 0.8em;">{{ msg.created_at|date:"d.m.Y H:i" }}</small>
            </div>
          </div>
        {% empty %}
          <p>–ü–æ–∫–∏ —â–æ –Ω–µ–º–∞—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å.</p>
        {% endfor %}
      </div>

      <form method="post" class="mt-3">
        {% csrf_token %}
        <div class="input-group">
          <input type="text" name="message" class="form-control" placeholder="–ù–∞–ø–∏—à—ñ—Ç—å –≤—ñ–¥–ø–æ–≤—ñ–¥—å..." required>
          <button class="btn btn-primary" type="submit">–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const chatBox = document.getElementById("chat-box");
  chatBox.scrollTop = chatBox.scrollHeight;
});
</script>
{% endblock %}
